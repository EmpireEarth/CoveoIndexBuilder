{
    "title" : "Omnibox results not updated when keyword gets appended between REST call and the response",
    "uri" : "http://answers.coveo.com/questions/1902/omnibox-results-not-updated-when-keyword-gets-appe.html",
    "printableUri" : "https://answers.coveo.com/questions/1902/omnibox-results-not-updated-when-keyword-gets-appe.html",
    "clickUri" : "https://answers.coveo.com/questions/1902/omnibox-results-not-updated-when-keyword-gets-appe.html",
    "uniqueId" : "42.4247$http://answers.coveo.com/questions/1902/omnibox-results-not-updated-when-keyword-gets-appe.html",
    "excerpt" : "Omnibox results not updated when keyword gets appended between REST call and the response ... Especially when the backend is slow (because of heavy load for instance) the search query runs behind.",
    "firstSentences" : null,
    "summary" : null,
    "flags" : "HasHtmlVersion",
    "hasHtmlVersion" : true,
    "hasMobileHtmlVersion" : false,
    "score" : 1030,
    "percentScore" : 72.21627,
    "rankingInfo" : null,
    "rating" : 3.0,
    "isTopResult" : false,
    "isRecommendation" : false,
    "titleHighlights" : [ ],
    "firstSentencesHighlights" : [ ],
    "excerptHighlights" : [ ],
    "printableUriHighlights" : [ ],
    "summaryHighlights" : [ ],
    "parentResult" : null,
    "childResults" : [ ],
    "totalNumberOfChildResults" : 0,
    "raw" : {
      "systitle" : "Omnibox results not updated when keyword gets appended between REST call and the response",
      "sysauthor" : "kevin bernaerts",
      "sysurihash" : "MgIdimVqktmApjr3",
      "urihash" : "MgIdimVqktmApjr3",
      "numberofanswers" : 1,
      "sysuri" : "https://answers.coveo.com/questions/1902/omnibox-results-not-updated-when-keyword-gets-appe.html",
      "sysprintableuri" : "https://answers.coveo.com/questions/1902/omnibox-results-not-updated-when-keyword-gets-appe.html",
      "sitemappriority" : 0.1,
      "systransactionid" : 160347,
      "questionaskeddatestring" : "·\n            Jun 06, 2014 at 01:54 PM ·",
      "tags" : [ "query", "results", "omnibox" ],
      "sysconcepts" : "query ; keyword ; omniboxes ; backend ; jquery context ; populateOmniBoxObject ; wordToSearch ; check ; onPopulateOmniBox ; myQueryIsTakingTooLong ; JQueryEventObject ; SearchInterface ; javascript ; buildOmniboxContent",
      "concepts" : "query ; keyword ; omniboxes ; backend ; jquery context ; populateOmniBoxObject ; wordToSearch ; check ; onPopulateOmniBox ; myQueryIsTakingTooLong ; JQueryEventObject ; SearchInterface ; javascript ; buildOmniboxContent",
      "printableuri" : "https://answers.coveo.com/questions/1902/omnibox-results-not-updated-when-keyword-gets-appe.html",
      "documenttype" : "WebPage",
      "sysindexeddate" : 1517941819000,
      "permanentid" : "c2449109b3bf54e5a21dd0236d55b6a2621a44550abd3de4955dfb5918d8",
      "syslanguage" : [ "English" ],
      "transactionid" : 160347,
      "title" : "Omnibox results not updated when keyword gets appended between REST call and the response",
      "date" : 1402012800000,
      "objecttype" : "Answers",
      "sitemapchangefrequency" : "Monthly",
      "answerauthor" : [ "olamothe" ],
      "hasanswer" : "true",
      "audience" : [ "Administrator", "Developer" ],
      "hasacceptedanswer" : "true",
      "sourcetype" : "Sitemap",
      "sysconnectortype" : "SitemapCrawler",
      "rowid" : 5446944,
      "numberofcomments" : 0,
      "size" : 73804,
      "sysdocumenttype" : "WebPage",
      "questionvotes" : 0,
      "clickableuri" : "https://answers.coveo.com/questions/1902/omnibox-results-not-updated-when-keyword-gets-appe.html",
      "syssource" : "AnswersCloud",
      "orderingid" : 212384744911577435,
      "acceptedanswers" : 1,
      "syssize" : 73804,
      "sysdate" : 1402012800000,
      "author" : "kevin bernaerts",
      "source" : "AnswersCloud",
      "questionbodyhtml" : "<div class=\"question-body\">\n                <p>Especially when the backend is slow (because of heavy load for instance) the search query runs behind. And when the keyword is already appended with some extra characters before the results of the first query are returned, the list of results in the omnibox dropdown does not correspond to the keyword at that moment.</p> \n<p>For instance:</p> \n<ul> \n <li><p> I want to search for \"special\" so I start to enter \"spe\". </p> </li> \n <li><p> An query gets triggered to the backend with q = spe </p> </li> \n <li><p> Because the backend is on heavy load, Coveo.Rest.SearchEndpoint.endpoints[\"default\"].search(query) doesn't return its results immediately. </p> </li> \n <li><p> of course I continue typing my keyword: special </p> </li> \n <li><p> I'm still waiting for results </p> </li> \n <li><p> the query finally returns results but for q = spe </p> </li> \n <li><p> I'm confused because I actually entered \"special\" and not just \"spe\".</p> <p> function buildOmniboxContent(regex) { return findValuesThatMatch(regex); }</p> <p> function findValuesThatMatch(q) { try { var builder = new Coveo.Ui.QueryBuilder(); builder.expression.add(q); var query = builder.build(); return Coveo.Rest.SearchEndpoint.endpoints[\"default\"].search(query); } catch(e) { window.console && console.log(\"Exception caught: \" + e.message); } return null; }</p> <p> function onPopulateOmniBox(e, populateOmniBoxObject) { var wordToSearch = populateOmniBoxObject.completeQueryExpression.word; var regexToSearch = populateOmniBoxObject.completeQueryExpression.regex;</p> <pre><code>   if (wordToSearch.length > 0) {\n     \n         var searchDeferred;\n         var deferred = $.Deferred();\n         \n         window.console && console.log(\"wordToSearch: \" + wordToSearch);\n         searchDeferred = buildOmniboxContent(wordToSearch);    // when the backend is slow, by the time it returns a result the keyword might already be different\n\n</code></pre> </li> \n</ul> \n<p>One solution might be to extend the above javascript code with some extra logic which verifies if the initial query is still the same as the one currently in the search box. However, for this I need to know the search box jquery element because there might be multiple omniboxes on the same page. (it's the case, we have one in the header and another one in the middle of the page) So I need the jquery context within the onPopulateOmniBox(e, populateOmniBoxObject) function.</p> \n<pre><code> searchDeferred = buildOmniboxContent(wordToSearch);    \n \n while (wordToSearch != KEYWORD_CURRENTLY_IN_SEARCHBOX ) {\n     wordToSearch = KEYWORD_CURRENTLY_IN_SEARCHBOX;\n     window.console && console.log(\"wordToSearch: \" + wordToSearch);\n     searchDeferred = buildOmniboxContent(wordToSearch);\n }\n</code></pre>\n                </div>",
      "sitemaplastmodified" : 1402012800000,
      "collection" : "default",
      "syssourcetype" : "Sitemap",
      "indexeddate" : 1517941819000,
      "questionnumber" : 1902,
      "connectortype" : "SitemapCrawler",
      "filetype" : "html",
      "sysclickableuri" : "https://answers.coveo.com/questions/1902/omnibox-results-not-updated-when-keyword-gets-appe.html",
      "sysfiletype" : "html",
      "language" : [ "English" ],
      "sitemapparenturl" : "http://answers.coveo.com/questions/1.xml",
      "questionauthor" : "kevin bernaerts",
      "sitename" : "Answers",
      "sysrowid" : 5446944,
      "uri" : "https://answers.coveo.com/questions/1902/omnibox-results-not-updated-when-keyword-gets-appe.html",
      "syscollection" : "default",
      "sitelanguage" : [ "English" ]
    },
    "Title" : "Omnibox results not updated when keyword gets appended between REST call and the response",
    "Uri" : "http://answers.coveo.com/questions/1902/omnibox-results-not-updated-when-keyword-gets-appe.html",
    "PrintableUri" : "https://answers.coveo.com/questions/1902/omnibox-results-not-updated-when-keyword-gets-appe.html",
    "ClickUri" : "https://answers.coveo.com/questions/1902/omnibox-results-not-updated-when-keyword-gets-appe.html",
    "UniqueId" : "42.4247$http://answers.coveo.com/questions/1902/omnibox-results-not-updated-when-keyword-gets-appe.html",
    "Excerpt" : "Omnibox results not updated when keyword gets appended between REST call and the response ... Especially when the backend is slow (because of heavy load for instance) the search query runs behind.",
    "FirstSentences" : null
  }