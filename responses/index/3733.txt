{
    "title" : "How to add a hive custom component value to Coveo state?",
    "uri" : "http://answers.coveo.com/questions/14320/how-to-add-a-hive-custom-component-value-to-coveo.html",
    "printableUri" : "https://answers.coveo.com/questions/14320/how-to-add-a-hive-custom-component-value-to-coveo.html",
    "clickUri" : "https://answers.coveo.com/questions/14320/how-to-add-a-hive-custom-component-value-to-coveo.html",
    "uniqueId" : "42.4247$http://answers.coveo.com/questions/14320/how-to-add-a-hive-custom-component-value-to-coveo.html",
    "excerpt" : "How to add a hive custom component value to Coveo state? ... Using Coveo Hive and CfS v4.1.82.12. ... I have a custom component with a start and end date to filter results, using a custom date fiel...",
    "firstSentences" : null,
    "summary" : null,
    "flags" : "HasHtmlVersion",
    "hasHtmlVersion" : true,
    "hasMobileHtmlVersion" : false,
    "score" : 1363,
    "percentScore" : 83.07386,
    "rankingInfo" : null,
    "rating" : 3.0,
    "isTopResult" : false,
    "isRecommendation" : false,
    "titleHighlights" : [ ],
    "firstSentencesHighlights" : [ ],
    "excerptHighlights" : [ ],
    "printableUriHighlights" : [ ],
    "summaryHighlights" : [ ],
    "parentResult" : null,
    "childResults" : [ ],
    "totalNumberOfChildResults" : 0,
    "raw" : {
      "systitle" : "How to add a hive custom component value to Coveo state?",
      "sysauthor" : "Paul Aldrich",
      "sysurihash" : "BGM0sV3gQDaJðy9z",
      "urihash" : "BGM0sV3gQDaJðy9z",
      "numberofanswers" : 1,
      "sysuri" : "https://answers.coveo.com/questions/14320/how-to-add-a-hive-custom-component-value-to-coveo.html",
      "sysprintableuri" : "https://answers.coveo.com/questions/14320/how-to-add-a-hive-custom-component-value-to-coveo.html",
      "sitemappriority" : 0.1,
      "systransactionid" : 160371,
      "questionaskeddatestring" : "·\n            Jan 24 at 09:37 PM ·",
      "tags" : [ "hive", "coveoforsitecore 4.1", "state" ],
      "sysconcepts" : "query string ; custom component ; start ; Paul Aldrich Paul Aldrich ; afterComponentsInitialize event ; Coveostate ; look ; initialization ; aoparesultdate ; registerNewAttribute ; source repository ; search interface ; François Lachance-Guillemette ; empty array ; constructor ; subscribers",
      "concepts" : "query string ; custom component ; start ; Paul Aldrich Paul Aldrich ; afterComponentsInitialize event ; Coveostate ; look ; initialization ; aoparesultdate ; registerNewAttribute ; source repository ; search interface ; François Lachance-Guillemette ; empty array ; constructor ; subscribers",
      "printableuri" : "https://answers.coveo.com/questions/14320/how-to-add-a-hive-custom-component-value-to-coveo.html",
      "documenttype" : "WebPage",
      "sysindexeddate" : 1517943553000,
      "permanentid" : "6cc35f9c85e47f85d23632bf594baa456d9c2ff0d48e429d2d92af3fa172",
      "syslanguage" : [ "English" ],
      "transactionid" : 160371,
      "title" : "How to add a hive custom component value to Coveo state?",
      "date" : 1516838400000,
      "objecttype" : "Answers",
      "sitemapchangefrequency" : "Monthly",
      "answerauthor" : [ "olamothe" ],
      "hasanswer" : "true",
      "audience" : [ "Administrator", "Developer" ],
      "commentauthor" : [ "Paul Aldrich", "Paul Aldrich", "François Lachance-Guillemette \u2666\u2666" ],
      "hasacceptedanswer" : "true",
      "sourcetype" : "Sitemap",
      "sysconnectortype" : "SitemapCrawler",
      "rowid" : 5449492,
      "numberofcomments" : 1,
      "size" : 80335,
      "sysdocumenttype" : "WebPage",
      "questionvotes" : 0,
      "clickableuri" : "https://answers.coveo.com/questions/14320/how-to-add-a-hive-custom-component-value-to-coveo.html",
      "syssource" : "AnswersCloud",
      "orderingid" : 212384744911579772,
      "acceptedanswers" : 1,
      "syssize" : 80335,
      "sysdate" : 1516838400000,
      "author" : "Paul Aldrich",
      "source" : "AnswersCloud",
      "questionbodyhtml" : "<div class=\"question-body\">\n                <p>\n<p>Using Coveo Hive and CfS v4.1.82.12. I have a custom component with a start and end date to filter results, using a custom date field I created. I am trying to figure out how to add the entered date range (start date and/or end date) to the Coveo state and thus the URL query string. Found something at the bottom of this document: <a rel=\"nofollow\" href=\"https://developers.coveo.com/display/public/JsSearchV1/State,\">https://developers.coveo.com/display/public/JsSearchV1/State,</a> but a few things:</p>\n<ol> \n <li>Running this code during the afterComponentsInitialization only runs it once on page load then never again after that. So I also added it after the advanced query is updated. </li>\n <li>The code itself adds the attribute correctly to the Coveostate property/object but the URL query string is not updated. </li>\n</ol>\n<p>Code:</p>\n<p>(Note, the hardcoded values in the registerNewAttribute call are for testing)</p> AOPADateRangePickerFacet.prototype.processQueryChange = function (coveoClass) { Coveo.$(this.bindings.searchInterface.element).on(Coveo.QueryEvents.buildingQuery, function (e, args) { var dateField = $(coveoClass.startDateField).closest('div.CoveoAOPADateRangePickerFacet').attr('data-field'); var newDateSet = coveoClass.getNewDateSet(coveoClass); NewDateSet = newDateSet; StartDate = $(coveoClass.startDateField).val(); EndDate = $(coveoClass.endDateField).val();\n<p> \n<pre><code>         // This becomes '@aoparesultdate&gt;=2018/1/1' for example\n         var expressionString = dateField + newDateSet;\n         args.queryBuilder.advancedExpression.add(expressionString);\n     });\n\n     // Update state\n     var searchInterface = coveoClass.bindings.searchInterface.element;\n     if (searchInterface.Coveostate !== undefined) {\n         searchInterface.Coveostate.registerNewAttribute(\"f:@aoparesultdate\", [\":range=[1072936800000,1479358944000]\"]);\n     }\n\n     this.bindings.usageAnalytics.logSearchEvent({\n         name: 'facetSelect',\n         type: 'facet'\n     });\n\n     this.bindings.queryController.executeQuery();\n };</pre>\n</code></pre> \n<p>\n<pre>    AOPADateRangePickerFacet.prototype.registerStateAttribute = function (coveoClass) {\n        Coveo.$(this.bindings.searchInterface.element).on(\"afterComponentsInitialization\", function (e) {\n            coveoClass.bindings.searchInterface.element\n                .Coveostate.registerNewAttribute(\"f:@aoparesultdate\", [\":range=[1072936800000,1479358944000]\"]);\n        });\n    }</pre>\n<p>Both functions are called when the custom component is initialized. </p> \n<p>\n                </div>",
      "sitemaplastmodified" : 1516838400000,
      "collection" : "default",
      "questionbodytext" : "AOPADateRangePickerFacet.prototype.processQueryChange = function (coveoClass) { Coveo.$(this.bindings.searchInterface.element).on(Coveo.QueryEvents.buildingQuery, function (e, args) { var dateField = $(coveoClass.startDateField).closest('div.CoveoAOPADateRangePickerFacet').attr('data-field'); var newDateSet = coveoClass.getNewDateSet(coveoClass); NewDateSet = newDateSet; StartDate = $(coveoClass.startDateField).val(); EndDate = $(coveoClass.endDateField).val();",
      "syssourcetype" : "Sitemap",
      "indexeddate" : 1517943553000,
      "questionnumber" : 14320,
      "connectortype" : "SitemapCrawler",
      "filetype" : "html",
      "sysclickableuri" : "https://answers.coveo.com/questions/14320/how-to-add-a-hive-custom-component-value-to-coveo.html",
      "sysfiletype" : "html",
      "language" : [ "English" ],
      "sitemapparenturl" : "http://answers.coveo.com/questions/1.xml",
      "questionauthor" : "Paul Aldrich",
      "sitename" : "Answers",
      "sysrowid" : 5449492,
      "uri" : "https://answers.coveo.com/questions/14320/how-to-add-a-hive-custom-component-value-to-coveo.html",
      "syscollection" : "default",
      "sitelanguage" : [ "English" ]
    },
    "Title" : "How to add a hive custom component value to Coveo state?",
    "Uri" : "http://answers.coveo.com/questions/14320/how-to-add-a-hive-custom-component-value-to-coveo.html",
    "PrintableUri" : "https://answers.coveo.com/questions/14320/how-to-add-a-hive-custom-component-value-to-coveo.html",
    "ClickUri" : "https://answers.coveo.com/questions/14320/how-to-add-a-hive-custom-component-value-to-coveo.html",
    "UniqueId" : "42.4247$http://answers.coveo.com/questions/14320/how-to-add-a-hive-custom-component-value-to-coveo.html",
    "Excerpt" : "How to add a hive custom component value to Coveo state? ... Using Coveo Hive and CfS v4.1.82.12. ... I have a custom component with a start and end date to filter results, using a custom date fiel...",
    "FirstSentences" : null
  }