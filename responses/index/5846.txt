{
    "title" : "Managing permissions on third party authentication using virtual users in Coveo for Sitecore",
    "uri" : "http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA13200000006rNCAQ/language:en_US",
    "printableUri" : "http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA13200000006rNCAQ/language:en_US",
    "clickUri" : "https://na61.salesforce.com/kA13200000006rN",
    "uniqueId" : "42.13819$http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA13200000006rNCAQ/language:en_US",
    "excerpt" : "You're using a third party solution to manage authentication in Sitecore via virtual user. ... The solution to generate virtual users follows this kind of pattern, which is supported by Coveo for S...",
    "firstSentences" : null,
    "summary" : null,
    "flags" : "HasHtmlVersion",
    "hasHtmlVersion" : true,
    "hasMobileHtmlVersion" : false,
    "score" : 1273,
    "percentScore" : 80.2843,
    "rankingInfo" : null,
    "rating" : 3.0,
    "isTopResult" : false,
    "isRecommendation" : false,
    "titleHighlights" : [ ],
    "firstSentencesHighlights" : [ ],
    "excerptHighlights" : [ ],
    "printableUriHighlights" : [ ],
    "summaryHighlights" : [ ],
    "parentResult" : null,
    "childResults" : [ ],
    "totalNumberOfChildResults" : 0,
    "raw" : {
      "systitle" : "Managing permissions on third party authentication using virtual users in Coveo for Sitecore",
      "sysurihash" : "0UGGK1WSðjG2IB97",
      "urihash" : "0UGGK1WSðjG2IB97",
      "parents" : "<?xml version=\"1.0\" encoding=\"utf-16\"?><parents><parent name=\"Organization\" uri=\"https://na61.salesforce.com/home/home.jsp\" /><parent name=\"KB_Article__ka\" uri=\"http://www.salesforce.com/org:organization/articletype:KB_Article\" /><parent name=\"Managing permissions on third party authentication using virtual users in Coveo for Sitecore\" uri=\"https://na61.salesforce.com/kA13200000006rN\" /></parents>",
      "sfdcarticletype" : "Problem/Fix",
      "sfresolutionc" : "<p>Here are some points to check in order to pinpoint the possible reason for this type of setup not to work:</p>\n\n<ul><li>Validate that the configuration file <tt>Coveo.SearchProvider.Rest.config</tt> contains the following processor. It is the one that passes the virtual user&#39;s roles to CES.</li></ul>\n\n<pre>\n&lt;getSearchUserIdentities&gt;\n        &lt;processor type=&quot;Coveo.SearchProvider.Rest.Processors.GetSearchUserIdentities.AddVirtualGroups, Coveo.SearchProvider.Rest&quot; /&gt;\n&lt;/getSearchUserIdentities&gt;\n</pre>\n\n<ul><li>Through the CES Admin Tool, verify which are the effective permissions on the expected secured documents. In my case, on the first attempt, <tt>extranet\\anonymous</tt> was denied but <tt>extranet\\NURSE</tt> was not allowed either. So I was not able to see the expected document. Granting explicit read access to the <tt>extranet\\NURSE</tt> role did the trick and I was then able to see the right results.</li></ul>\n\n<ul><li>Open an incognito browser session and navigate to the search page.\n\t<ul><li>Open the developer tools.</li><li>Add the <tt>debug=1</tt> query string parameter (e.g. <tt><a href=\"http://mysitecore/search?debug=1\" target=\"_blank\">http://mySitecore/search?debug=1</a></tt>).</li><li>Look at the network tab and find the request made to <tt>/coveo/rest</tt>.</li><li>Select the response&#39;s <b>Preview</b> tab to see the pretty JSON response.</li><li>At the bottom, expand the <tt>userIdentities</tt> property. If the virtual user is set, you should see many identities. The first one is the virtual user itself and the others are the roles added to the virtual user. If you only see the <tt>extranet\\anonymous</tt> identity, then it means that the current browser session is not using the virtual user and therefore won&#39;t have access to the restricted pages.</li></ul>\n\t</li></ul>",
      "sysuri" : "http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA13200000006rNCAQ/language:en_US",
      "sysprintableuri" : "http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA13200000006rNCAQ/language:en_US",
      "sflastpublisheddate" : 1478895911000,
      "systransactionid" : 161138,
      "sfversionc" : "3.0",
      "sfurlname" : "1269",
      "sfsystemmodstamp" : 1511955956000,
      "sfisvisibleinapp" : "true",
      "sysconcepts" : "virtual users ; coveo ; Sitecore ; extranet ; browser session ; getSearchUserIdentities ; SearchProvider ; identities ; userIdentities property ; expected secured ; effective permissions ; kind of pattern ; AddVirtualGroups ; authentication",
      "sfkbversionnumber" : "3",
      "concepts" : "virtual users ; coveo ; Sitecore ; extranet ; browser session ; getSearchUserIdentities ; SearchProvider ; identities ; userIdentities property ; expected secured ; effective permissions ; kind of pattern ; AddVirtualGroups ; authentication",
      "printableuri" : "http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA13200000006rNCAQ/language:en_US",
      "documenttype" : "article",
      "sfkbarticlekavid" : "ka132000000LHZaAAO",
      "sysindexeddate" : 1518187513000,
      "sfknowledgearticleid" : "kA13200000006rNCAQ",
      "sfcreatedbyid" : "00560000003q7JgAAI",
      "sfconnectorc" : "N/A",
      "permanentid" : "6fa58c8b13082f979b73dad0143987a83156c50a7d7b8769892bf5d7d4de",
      "syslanguage" : [ "English" ],
      "transactionid" : 161138,
      "sfisvisibleinprm" : "true",
      "title" : "Managing permissions on third party authentication using virtual users in Coveo for Sitecore",
      "sfversionnumber" : 3,
      "sfarticlenumber" : "000001269",
      "date" : 1511955956000,
      "objecttype" : "KB Article",
      "allmetadatavalues" : "{\"kav_lastmodifiedby.attribute.type\": [\"User\"], \"coveo_short_id\": [\"kA13200000006rN\"], \"sflastmodifiedbyname\": [\"Michael Carter\"], \"kav_coveo_version__c__html_stripped\": [\"\"], \"fileextension\": [\"\"], \"sfdcexpandedproduct\": [\"All;All|Sitecore\"], \"kav_createdby.attribute.url\": [\"/services/data/v34.0/sobjects/User/00560000003q7JgAAI\"], \"sflanguage\": [\"en_US\"], \"kav_createdby.attribute.type\": [\"User\"], \"kav_createdby.id\": [\"00560000003q7JgAAI\"], \"kav_language\": [\"en_US\"], \"sfsitecoreversionc\": [\"N/A\"], \"sourcetype\": [\"Salesforce\"], \"title\": [\"Managing permissions on third party authentication using virtual users in Coveo for Sitecore\"], \"source\": [\"Salesforce Public Items\"], \"kav_owner.attribute.url\": [\"/services/data/v34.0/sobjects/User/00560000003q7JgAAI\"], \"parents\": [\"<?xml version=\\\"1.0\\\" encoding=\\\"utf-16\\\"?><parents><parent name=\\\"Organization\\\" uri=\\\"https://na61.salesforce.com/home/home.jsp\\\" /><parent name=\\\"KB_Article__ka\\\" uri=\\\"http://www.salesforce.com/org:organization/articletype:KB_Article\\\" /><parent name=\\\"Managing permissions on third party authentication using virtual users in Coveo for Sitecore\\\" uri=\\\"https://na61.salesforce.com/kA13200000006rN\\\" /></parents>\"], \"sfisvisibleinprm\": [true], \"kav_title\": [\"Managing permissions on third party authentication using virtual users in Coveo for Sitecore\"], \"kav_isvisibleincsp\": [true], \"hashtmlversion\": [true], \"sfarticletypec\": [\"How To\"], \"kav_version__c\": [\"3.0\"], \"kav_versionnumber\": [3], \"sfcreatedbyname\": [\"Frederic Cote\"], \"sflastpublisheddate\": [1478895911], \"objecttypelabel\": [\"KB Article\"], \"kav_cause__c__html_stripped\": [\"Unconfirmed\"], \"originalhtmlcharset\": [1200], \"coveo_connector_hasbinarydata\": [false], \"kav_lastpublisheddate\": [1478895911], \"sfsystemmodstamp\": [1511955956], \"ka_attribute.type\": [\"KB_Article__ka\"], \"sfdcproduct\": [\"Sitecore\"], \"clickableuri\": [\"https://na61.salesforce.com/kA13200000006rN\"], \"kav_dc_expanded_product\": [\"All;All|Sitecore\"], \"sftitle\": [\"Managing permissions on third party authentication using virtual users in Coveo for Sitecore\"], \"kav_owner.id\": [\"00560000003q7JgAAI\"], \"sfbuildc\": [\"1188\"], \"sfisvisibleinapp\": [true], \"ka_attribute.url\": [\"/services/data/v34.0/sobjects/KB_Article__ka/kA13200000006rNCAQ\"], \"sfdcarticletype\": [\"Problem/Fix\"], \"kav_cause__c\": [\"Unconfirmed\"], \"sfislatestversion\": [true], \"sfcausec\": [\"Unconfirmed\"], \"contenttype\": [\"binarydata\"], \"sfurlname\": [\"1269\"], \"ka_id\": [\"kA13200000006rNCAQ\"], \"kav_datacategoryselections.datacategoryname\": [\"Configuration;Sitecore\"], \"coveo_url\": [\"https://na61.salesforce.com/kA13200000006rN\"], \"kav_urlname\": [\"1269\"], \"kav_articletype\": [\"KB_Article__kav\"], \"foldingcollection\": [\"cb27f43fd29a8fc5cbf7b677cf7dca28a63b26a5c9dd9c0d961433f80017\"], \"body\": [\"<html>   <body>     <div style=\\\"background-color: #fff;border: 2px solid #BBC5CC;border-radius: 4px;float: left;font-family: lato;margin-left: 15px;margin-right: 15px;margin-bottom: 4%;padding: 10px;width: 60%;\\\">       <div style=\\\"font-size: 1.5em;font-weight: 600;Padding-top: 30px;border-bottom: 1px solid #BBC5CC;\\\">         <div style=\\\"border-left: 1px solid #BBC5CC;border-top: 1px solid #BBC5CC;color: #296896;padding: 10px;width: 15%;\\\">           Description         </div>       </div>       <div style=\\\"margin-left: 35px;margin-top: 10px;font-size: 1em;\\\"> <u><b>Context</b></u><br>You&#39;re using a third party solution to manage authentication in Sitecore via virtual user.<br><br>The solution to generate virtual users follows this kind of pattern, which is supported by Coveo for Sitecore<br>\\u00a0\\n<pre class=\\\"ckeditor_codeblock\\\">\\n// Create virtual user\\nvar virtualUser = Sitecore.Security.Authentication.AuthenticationManager.BuildVirtualUser(&quot;ganesh.a.ramesh@accenture.com&quot;, true);\\n \\n// You can add roles to the Virtual user\\nvirtualUser.Roles.Add(Sitecore.Security.Accounts.Role.FromName(&quot;extranet\\\\\\\\NURSE&quot;));\\n \\n// You can even work with the profile if you wish\\nvirtualUser.Profile.SetCustomProperty(&quot;CustomProperty&quot;, &quot;12345&quot;);\\nvirtualUser.Profile.Email = &quot;user@domain.com&quot;;\\nvirtualUser.Profile.Name = &quot;My User&quot;;\\n \\n// Login the virtual user\\nSitecore.Security.Authentication.AuthenticationManager.LoginVirtualUser(virtualUser);</pre>\\n<br>Reference:\\u00a0<span style=\\\"font-size: 9.0pt;\\\"><a href=\\\"https://briancaos.wordpress.com/2015/11/13/sitecore-virtual-users-authenticate-users-from-external-systems/\\\" target=\\\"_blank\\\">https://briancaos.wordpress.com/2015/11/13/sitecore-virtual-users-authenticate-users-from-external-systems/</a></span><br><br>Also, your Sitecore has some restricted content that needs to be accessed only by certain users such as:<br>\\u00a0\\n<ol><li><span style=\\\"font-size: 9.0pt;\\\">Extranet\\\\NURSE</span></li><li><span style=\\\"font-size: 9.0pt;\\\">Extranet\\\\MEDICAL_SPECIALIST</span></li><li><span style=\\\"font-size: 9.0pt;\\\">EXTRANET\\\\PHARMACIST</span></li><li><span style=\\\"font-size: 9.0pt;\\\">EXTRANET\\\\GENERAL_PRACTITIONER</span></li><li><span style=\\\"font-size: 9.0pt;\\\">Extranet\\\\Anonymous (By default, only in Login page)</span></li></ol>\\n<u><b>Problem</b></u><br><br>When a visitor connects to the site, his virtual user gets one of the 5 profile attached to it. The problem is that those users only have access to the non-restricted content just as if they were extranet\\\\anonymous<br><br><br><br>\\u00a0</div>       <div style=\\\"font-size: 1.5em;font-weight: 600;Padding-top: 30px;border-bottom: 1px solid #BBC5CC;\\\">         <div style=\\\"border-left: 1px solid #BBC5CC;border-top: 1px solid #BBC5CC;color: #296896;padding: 10px;width: 15%;\\\">           Environment         </div>       </div>       <br/>       <table>         <tr>           <td style=\\\"margin-left: 35px;margin-top: 10px;font-size: 1em;font-weight: 600;\\\">Product</td>           <td>Sitecore</td>           <td style=\\\"margin-left: 35px;margin-top: 10px;font-size: 1em;font-weight: 600;\\\">Sitecore Version</td>           <td>N/A</td>           <td style=\\\"margin-left: 35px;margin-top: 10px;font-size: 1em;font-weight: 600;\\\">Connector</td>           <td>N/A</td>         </tr>         <tr>           <td style=\\\"margin-left: 35px;margin-top: 10px;font-size: 1em;font-weight: 600;\\\">Published</td>           <td>1478895911</td>           <td style=\\\"margin-left: 35px;margin-top: 10px;font-size: 1em;font-weight: 600;\\\">Version</td>           <td>3.0</td>           <td style=\\\"margin-left: 35px;margin-top: 10px;font-size: 1em;font-weight: 600;\\\">Build</td>           <td>1188</td>         </tr>       </table>       <br/>       <div style=\\\"font-size: 1.5em;font-weight: 600;Padding-top: 30px;border-bottom: 1px solid #BBC5CC;\\\">         <div style=\\\"border-left: 1px solid #BBC5CC;border-top: 1px solid #BBC5CC;color: #296896;padding: 10px;width: 15%;\\\">           Cause         </div>       </div>       <div style=\\\"margin-left: 35px;margin-top: 10px;font-size: 1em;\\\"> Unconfirmed</div>       <div style=\\\"font-size: 1.5em;font-weight: 600;Padding-top: 30px;border-bottom: 1px solid #BBC5CC;\\\">         <div style=\\\"border-left: 1px solid #BBC5CC;border-top: 1px solid #BBC5CC;color: #296896;padding: 10px;width: 15%;\\\">           Resolution         </div>       </div>       <div style=\\\"margin-left: 35px;margin-top: 10px;font-size: 1em;\\\"> <p>Here are some points to check in order to pinpoint the possible reason for this type of setup not to work:</p>\\n\\n<ul><li>Validate that the configuration file\\u00a0<tt>Coveo.SearchProvider.Rest.config</tt>\\u00a0contains the following processor. It is the one that passes the virtual user&#39;s roles to CES.</li></ul>\\n\\n<pre>\\n&lt;getSearchUserIdentities&gt;\\n        &lt;processor type=&quot;Coveo.SearchProvider.Rest.Processors.GetSearchUserIdentities.AddVirtualGroups, Coveo.SearchProvider.Rest&quot; /&gt;\\n&lt;/getSearchUserIdentities&gt;\\n</pre>\\n\\n<ul><li>Through the CES Admin Tool, verify which are the effective permissions on the expected secured documents. In my case, on the first attempt,\\u00a0<tt>extranet\\\\anonymous</tt>\\u00a0was denied but\\u00a0<tt>extranet\\\\NURSE</tt>\\u00a0was not allowed either. So I was not able to see the expected document. Granting explicit read access to the\\u00a0<tt>extranet\\\\NURSE</tt>\\u00a0role did the trick and I was then able to see the right results.</li></ul>\\n\\n<ul><li>Open an incognito browser session and navigate to the search page.\\n\\t<ul><li>Open the developer tools.</li><li>Add the\\u00a0<tt>debug=1</tt>\\u00a0query string parameter (e.g.\\u00a0<tt><a href=\\\"http://mysitecore/search?debug=1\\\" target=\\\"_blank\\\">http://mySitecore/search?debug=1</a></tt>).</li><li>Look at the network tab and find the request made to\\u00a0<tt>/coveo/rest</tt>.</li><li>Select the response&#39;s\\u00a0<b>Preview</b>\\u00a0tab to see the pretty JSON response.</li><li>At the bottom, expand the\\u00a0<tt>userIdentities</tt>\\u00a0property. If the virtual user is set, you should see many identities. The first one is the virtual user itself and the others are the roles added to the virtual user. If you only see the\\u00a0<tt>extranet\\\\anonymous</tt>\\u00a0identity, then it means that the current browser session is not using the virtual user and therefore won&#39;t have access to the restricted pages.</li></ul>\\n\\t</li></ul></div>     </div>   </body> </html>\"], \"kav_product__c\": [\"Sitecore\"], \"kav_article_type__c\": [\"How To\"], \"sfpublishstatus\": [\"Online\"], \"sfcreatedbyid\": [\"00560000003q7JgAAI\"], \"kav_description__c__html_stripped\": [\"Context \\n You're using a third party solution to manage authentication in Sitecore via virtual user. \\n \\n The solution to generate virtual users follows this kind of pattern, which is supported by Coveo for Sitecore \\n \\u00a0\\n \\n// Create virtual user\\nvar virtualUser = Sitecore.Security.Authentication.AuthenticationManager.BuildVirtualUser(\\\"ganesh.a.ramesh@accenture.com\\\", true);\\n \\n// You can add roles to the Virtual user\\nvirtualUser.Roles.Add(Sitecore.Security.Accounts.Role.FromName(\\\"extranet\\\\\\\\NURSE\\\"));\\n \\n// You can even work with the profile if you wish\\nvirtualUser.Profile.SetCustomProperty(\\\"CustomProperty\\\", \\\"12345\\\");\\nvirtualUser.Profile.Email = \\\"user@domain.com\\\";\\nvirtualUser.Profile.Name = \\\"My User\\\";\\n \\n// Login the virtual user\\nSitecore.Security.Authentication.AuthenticationManager.LoginVirtualUser(virtualUser); \\n \\n Reference:\\u00a0 https://briancaos.wordpress.com/2015/11/13/sitecore-virtual-users-authenticate-users-from-external-systems/ \\n \\n Also, your Sitecore has some restricted content that needs to be accessed only by certain users such as: \\n \\u00a0\\n Extranet\\\\NURSE Extranet\\\\MEDICAL_SPECIALIST EXTRANET\\\\PHARMACIST EXTRANET\\\\GENERAL_PRACTITIONER Extranet\\\\Anonymous (By default, only in Login page) \\n Problem \\n \\n When a visitor connects to the site, his virtual user gets one of the 5 profile attached to it. The problem is that those users only have access to the non-restricted content just as if they were extranet\\\\anonymous \\n \\n \\n \\n \\u00a0\"], \"kav_islatestversion\": [true], \"kav_knowledgearticleid\": [\"kA13200000006rNCAQ\"], \"sfknowledgearticleid\": [\"kA13200000006rNCAQ\"], \"sfownername\": [\"Frederic Cote\"], \"kav_datacategoryselections.attribute.type\": [\"KB_Article__DataCategorySelection;KB_Article__DataCategorySelection\"], \"detectedtitle\": [\"Description\"], \"kav_createddate\": [1478895880], \"kav_build__c\": [\"1188\"], \"language\": [\"English\"], \"coveo_foldingchild\": [\"b56d38288b08961e830fc00ff41a98e2e51df24ff5b9776a88e29367b3f8\"], \"sfownerid\": [\"00560000003q7JgAAI\"], \"kav_createdby.coveo_record_size\": [2], \"kav_systemmodstamp\": [1511955956], \"objecttype\": [\"KB Article\"], \"connectortype\": [\"Salesforce2\"], \"kav_coveo_record_size\": [4], \"originaluri\": [\"http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA13200000006rNCAQ/language:en_US\"], \"sfisvisibleincsp\": [true], \"convertertype\": [\"TYPE_HTML\"], \"filetype\": [\"SalesforceItem\"], \"kav_owner.name\": [\"Frederic Cote\"], \"sfdcexpandedarticletype\": [\"All;All|Problem/Fix\"], \"objecttypelabelplural\": [\"KB Articles\"], \"sfcurrencyisocode\": [\"CAD\"], \"sfisdeleted\": [false], \"extractedsize\": [6298], \"size\": [9203], \"kav_publishstatus\": [\"Online\"], \"kav_connector__c\": [\"N/A\"], \"generateexcerpt\": [true], \"sfdescriptionc\": [\"<u><b>Context</b></u><br>You&#39;re using a third party solution to manage authentication in Sitecore via virtual user.<br><br>The solution to generate virtual users follows this kind of pattern, which is supported by Coveo for Sitecore<br>\\u00a0\\n<pre class=\\\"ckeditor_codeblock\\\">\\n// Create virtual user\\nvar virtualUser = Sitecore.Security.Authentication.AuthenticationManager.BuildVirtualUser(&quot;ganesh.a.ramesh@accenture.com&quot;, true);\\n \\n// You can add roles to the Virtual user\\nvirtualUser.Roles.Add(Sitecore.Security.Accounts.Role.FromName(&quot;extranet\\\\\\\\NURSE&quot;));\\n \\n// You can even work with the profile if you wish\\nvirtualUser.Profile.SetCustomProperty(&quot;CustomProperty&quot;, &quot;12345&quot;);\\nvirtualUser.Profile.Email = &quot;user@domain.com&quot;;\\nvirtualUser.Profile.Name = &quot;My User&quot;;\\n \\n// Login the virtual user\\nSitecore.Security.Authentication.AuthenticationManager.LoginVirtualUser(virtualUser);</pre>\\n<br>Reference:\\u00a0<span style=\\\"font-size: 9.0pt;\\\"><a href=\\\"https://briancaos.wordpress.com/2015/11/13/sitecore-virtual-users-authenticate-users-from-external-systems/\\\" target=\\\"_blank\\\">https://briancaos.wordpress.com/2015/11/13/sitecore-virtual-users-authenticate-users-from-external-systems/</a></span><br><br>Also, your Sitecore has some restricted content that needs to be accessed only by certain users such as:<br>\\u00a0\\n<ol><li><span style=\\\"font-size: 9.0pt;\\\">Extranet\\\\NURSE</span></li><li><span style=\\\"font-size: 9.0pt;\\\">Extranet\\\\MEDICAL_SPECIALIST</span></li><li><span style=\\\"font-size: 9.0pt;\\\">EXTRANET\\\\PHARMACIST</span></li><li><span style=\\\"font-size: 9.0pt;\\\">EXTRANET\\\\GENERAL_PRACTITIONER</span></li><li><span style=\\\"font-size: 9.0pt;\\\">Extranet\\\\Anonymous (By default, only in Login page)</span></li></ol>\\n<u><b>Problem</b></u><br><br>When a visitor connects to the site, his virtual user gets one of the 5 profile attached to it. The problem is that those users only have access to the non-restricted content just as if they were extranet\\\\anonymous<br><br><br><br>\\u00a0\"], \"sfarticletype\": [\"KB_Article__kav\"], \"kav_lastmodifieddate\": [1478895911], \"documenttype\": [\"article\"], \"sfkbarticlekavid\": [\"ka132000000LHZaAAO\"], \"kav_currencyisocode\": [\"CAD\"], \"sfproductc\": [\"Sitecore\"], \"foldingparent\": [\"b56d38288b08961e830fc00ff41a98e2e51df24ff5b9776a88e29367b3f8\"], \"mappingtype\": [\"KB_Article\"], \"kav_isvisibleinpkb\": [true], \"kav_sourceid\": [\"5003200000ySUHyAAO\"], \"sfkbversionnumber\": [3], \"kav_isvisibleinapp\": [true], \"kav_resolution__c\": [\"<p>Here are some points to check in order to pinpoint the possible reason for this type of setup not to work:</p>\\n\\n<ul><li>Validate that the configuration file\\u00a0<tt>Coveo.SearchProvider.Rest.config</tt>\\u00a0contains the following processor. It is the one that passes the virtual user&#39;s roles to CES.</li></ul>\\n\\n<pre>\\n&lt;getSearchUserIdentities&gt;\\n        &lt;processor type=&quot;Coveo.SearchProvider.Rest.Processors.GetSearchUserIdentities.AddVirtualGroups, Coveo.SearchProvider.Rest&quot; /&gt;\\n&lt;/getSearchUserIdentities&gt;\\n</pre>\\n\\n<ul><li>Through the CES Admin Tool, verify which are the effective permissions on the expected secured documents. In my case, on the first attempt,\\u00a0<tt>extranet\\\\anonymous</tt>\\u00a0was denied but\\u00a0<tt>extranet\\\\NURSE</tt>\\u00a0was not allowed either. So I was not able to see the expected document. Granting explicit read access to the\\u00a0<tt>extranet\\\\NURSE</tt>\\u00a0role did the trick and I was then able to see the right results.</li></ul>\\n\\n<ul><li>Open an incognito browser session and navigate to the search page.\\n\\t<ul><li>Open the developer tools.</li><li>Add the\\u00a0<tt>debug=1</tt>\\u00a0query string parameter (e.g.\\u00a0<tt><a href=\\\"http://mysitecore/search?debug=1\\\" target=\\\"_blank\\\">http://mySitecore/search?debug=1</a></tt>).</li><li>Look at the network tab and find the request made to\\u00a0<tt>/coveo/rest</tt>.</li><li>Select the response&#39;s\\u00a0<b>Preview</b>\\u00a0tab to see the pretty JSON response.</li><li>At the bottom, expand the\\u00a0<tt>userIdentities</tt>\\u00a0property. If the virtual user is set, you should see many identities. The first one is the virtual user itself and the others are the roles added to the virtual user. If you only see the\\u00a0<tt>extranet\\\\anonymous</tt>\\u00a0identity, then it means that the current browser session is not using the virtual user and therefore won&#39;t have access to the restricted pages.</li></ul>\\n\\t</li></ul>\"], \"coveo_objecttype\": [\"KB_Article\"], \"printableuri\": [\"http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA13200000006rNCAQ/language:en_US\"], \"kav_datacategoryselections.attribute.url\": [\"/services/data/v34.0/sobjects/KB_Article__DataCategorySelection/02o32000000poShAAI;/services/data/v34.0/sobjects/KB_Article__DataCategorySelection/02o32000000poSiAAI\"], \"kav_id\": [\"ka132000000LHZaAAO\"], \"sfresolutionc\": [\"<p>Here are some points to check in order to pinpoint the possible reason for this type of setup not to work:</p>\\n\\n<ul><li>Validate that the configuration file\\u00a0<tt>Coveo.SearchProvider.Rest.config</tt>\\u00a0contains the following processor. It is the one that passes the virtual user&#39;s roles to CES.</li></ul>\\n\\n<pre>\\n&lt;getSearchUserIdentities&gt;\\n        &lt;processor type=&quot;Coveo.SearchProvider.Rest.Processors.GetSearchUserIdentities.AddVirtualGroups, Coveo.SearchProvider.Rest&quot; /&gt;\\n&lt;/getSearchUserIdentities&gt;\\n</pre>\\n\\n<ul><li>Through the CES Admin Tool, verify which are the effective permissions on the expected secured documents. In my case, on the first attempt,\\u00a0<tt>extranet\\\\anonymous</tt>\\u00a0was denied but\\u00a0<tt>extranet\\\\NURSE</tt>\\u00a0was not allowed either. So I was not able to see the expected document. Granting explicit read access to the\\u00a0<tt>extranet\\\\NURSE</tt>\\u00a0role did the trick and I was then able to see the right results.</li></ul>\\n\\n<ul><li>Open an incognito browser session and navigate to the search page.\\n\\t<ul><li>Open the developer tools.</li><li>Add the\\u00a0<tt>debug=1</tt>\\u00a0query string parameter (e.g.\\u00a0<tt><a href=\\\"http://mysitecore/search?debug=1\\\" target=\\\"_blank\\\">http://mySitecore/search?debug=1</a></tt>).</li><li>Look at the network tab and find the request made to\\u00a0<tt>/coveo/rest</tt>.</li><li>Select the response&#39;s\\u00a0<b>Preview</b>\\u00a0tab to see the pretty JSON response.</li><li>At the bottom, expand the\\u00a0<tt>userIdentities</tt>\\u00a0property. If the virtual user is set, you should see many identities. The first one is the virtual user itself and the others are the roles added to the virtual user. If you only see the\\u00a0<tt>extranet\\\\anonymous</tt>\\u00a0identity, then it means that the current browser session is not using the virtual user and therefore won&#39;t have access to the restricted pages.</li></ul>\\n\\t</li></ul>\"], \"foldingchild\": [\"b56d38288b08961e830fc00ff41a98e2e51df24ff5b9776a88e29367b3f8\"], \"sfcreateddate\": [1478895880], \"kav_sitecore_version__c\": [\"N/A\"], \"kav_owner.coveo_record_size\": [2], \"kav_coveo_effective_modstamp\": [1511955956], \"kav_summary__html_stripped\": [\"\"], \"kav_dc_article_type\": [\"Problem/Fix\"], \"sfconnectorc\": [\"N/A\"], \"kav_dc_product\": [\"Sitecore\"], \"ka_coveo_record_size\": [2], \"kav_dc_expanded_article_type\": [\"All;All|Problem/Fix\"], \"kav_datacategoryselections.coveo_record_size\": [\"2;2\"], \"concepts\": [\"virtual users ; coveo ; Sitecore ; extranet ; browser session ; getSearchUserIdentities ; SearchProvider ; identities ; userIdentities property ; expected secured ; effective permissions ; kind of pattern ; AddVirtualGroups ; authentication\"], \"sfkbid\": [\"kA13200000006rNCAQ\"], \"kav_firstpublisheddate\": [1459958137], \"coveo_organization_id\": [\"00D3000000007r2\"], \"coveo_foldingcollection\": [\"cb27f43fd29a8fc5cbf7b677cf7dca28a63b26a5c9dd9c0d961433f80017\"], \"sffirstpublisheddate\": [1459958137], \"sflastmodifieddate\": [1478895911], \"kav_resolution__c__html_stripped\": [\"Here are some points to check in order to pinpoint the possible reason for this type of setup not to work:\\n \\n\\n Validate that the configuration file\\u00a0 Coveo.SearchProvider.Rest.config \\u00a0contains the following processor. It is the one that passes the virtual user's roles to CES. \\n\\n \\n<getSearchUserIdentities>\\n        <processor type=\\\"Coveo.SearchProvider.Rest.Processors.GetSearchUserIdentities.AddVirtualGroups, Coveo.SearchProvider.Rest\\\" />\\n</getSearchUserIdentities>\\n \\n\\n Through the CES Admin Tool, verify which are the effective permissions on the expected secured documents. In my case, on the first attempt,\\u00a0 extranet\\\\anonymous \\u00a0was denied but\\u00a0 extranet\\\\NURSE \\u00a0was not allowed either. So I was not able to see the expected document. Granting explicit read access to the\\u00a0 extranet\\\\NURSE \\u00a0role did the trick and I was then able to see the right results. \\n\\n Open an incognito browser session and navigate to the search page.\\n\\t Open the developer tools. Add the\\u00a0 debug=1 \\u00a0query string parameter (e.g.\\u00a0 http://mySitecore/search?debug=1 ). Look at the network tab and find the request made to\\u00a0 /coveo/rest . Select the response's\\u00a0 Preview \\u00a0tab to see the pretty JSON response. At the bottom, expand the\\u00a0 userIdentities \\u00a0property. If the virtual user is set, you should see many identities. The first one is the virtual user itself and the others are the roles added to the virtual user. If you only see the\\u00a0 extranet\\\\anonymous \\u00a0identity, then it means that the current browser session is not using the virtual user and therefore won't have access to the restricted pages. \\n\\t\"], \"kav_vendor_version__c__html_stripped\": [\"\"], \"detectedlanguage\": [1], \"kav_isvisibleinprm\": [true], \"kav_owner.attribute.type\": [\"Name\"], \"kav_lastmodifiedby.attribute.url\": [\"/services/data/v34.0/sobjects/User/00532000004vbsoAAA\"], \"sfversionc\": [\"3.0\"], \"sitename\": [\"Community\"], \"kav_createdby.name\": [\"Frederic Cote\"], \"sfarticlenumber\": [\"000001269\"], \"kav_lastmodifiedby.coveo_record_size\": [2], \"sfisvisibleinpkb\": [true], \"kav_datacategoryselections.id\": [\"02o32000000poShAAI;02o32000000poSiAAI\"], \"kav_description__c\": [\"<u><b>Context</b></u><br>You&#39;re using a third party solution to manage authentication in Sitecore via virtual user.<br><br>The solution to generate virtual users follows this kind of pattern, which is supported by Coveo for Sitecore<br>\\u00a0\\n<pre class=\\\"ckeditor_codeblock\\\">\\n// Create virtual user\\nvar virtualUser = Sitecore.Security.Authentication.AuthenticationManager.BuildVirtualUser(&quot;ganesh.a.ramesh@accenture.com&quot;, true);\\n \\n// You can add roles to the Virtual user\\nvirtualUser.Roles.Add(Sitecore.Security.Accounts.Role.FromName(&quot;extranet\\\\\\\\NURSE&quot;));\\n \\n// You can even work with the profile if you wish\\nvirtualUser.Profile.SetCustomProperty(&quot;CustomProperty&quot;, &quot;12345&quot;);\\nvirtualUser.Profile.Email = &quot;user@domain.com&quot;;\\nvirtualUser.Profile.Name = &quot;My User&quot;;\\n \\n// Login the virtual user\\nSitecore.Security.Authentication.AuthenticationManager.LoginVirtualUser(virtualUser);</pre>\\n<br>Reference:\\u00a0<span style=\\\"font-size: 9.0pt;\\\"><a href=\\\"https://briancaos.wordpress.com/2015/11/13/sitecore-virtual-users-authenticate-users-from-external-systems/\\\" target=\\\"_blank\\\">https://briancaos.wordpress.com/2015/11/13/sitecore-virtual-users-authenticate-users-from-external-systems/</a></span><br><br>Also, your Sitecore has some restricted content that needs to be accessed only by certain users such as:<br>\\u00a0\\n<ol><li><span style=\\\"font-size: 9.0pt;\\\">Extranet\\\\NURSE</span></li><li><span style=\\\"font-size: 9.0pt;\\\">Extranet\\\\MEDICAL_SPECIALIST</span></li><li><span style=\\\"font-size: 9.0pt;\\\">EXTRANET\\\\PHARMACIST</span></li><li><span style=\\\"font-size: 9.0pt;\\\">EXTRANET\\\\GENERAL_PRACTITIONER</span></li><li><span style=\\\"font-size: 9.0pt;\\\">Extranet\\\\Anonymous (By default, only in Login page)</span></li></ol>\\n<u><b>Problem</b></u><br><br>When a visitor connects to the site, his virtual user gets one of the 5 profile attached to it. The problem is that those users only have access to the non-restricted content just as if they were extranet\\\\anonymous<br><br><br><br>\\u00a0\"], \"kav_attribute.url\": [\"/services/data/v34.0/sobjects/KB_Article__kav/ka132000000LHZaAAO\"], \"kav_articlenumber__stripped\": [\"1269\"], \"sfversionnumber\": [3], \"kav_attribute.type\": [\"KB_Article__kav\"], \"kav_validationstatus\": [\"Reviewed\"], \"coveo_foldingparent\": [\"b56d38288b08961e830fc00ff41a98e2e51df24ff5b9776a88e29367b3f8\"], \"collection\": [\"default\"], \"sfsourceid\": [\"5003200000ySUHyAAO\"], \"date\": [1511955956], \"kav_lastmodifiedby.id\": [\"00532000004vbsoAAA\"], \"kav_datacategoryselections.datacategorygroupname\": [\"Article_Type;Product\"], \"conversionstate\": [0], \"sfvalidationstatus\": [\"Reviewed\"], \"kav_isdeleted\": [false], \"sflastmodifiedbyid\": [\"00532000004vbsoAAA\"], \"kav_lastmodifiedby.name\": [\"Michael Carter\"], \"kav_articlenumber\": [\"000001269\"], \"permanentid\": [\"6fa58c8b13082f979b73dad0143987a83156c50a7d7b8769892bf5d7d4de\"]}",
      "sfbuildc" : "1188",
      "sflastmodifiedbyid" : "00532000004vbsoAAA",
      "sfproductc" : "Sitecore",
      "syssfownerid" : "00560000003q7JgAAI",
      "sfsitecoreversionc" : "N/A",
      "sourcetype" : "Salesforce",
      "sysconnectortype" : "Salesforce2",
      "sftitle" : "Managing permissions on third party authentication using virtual users in Coveo for Sitecore",
      "rowid" : 5492095,
      "syssfcreatedbyid" : "00560000003q7JgAAI",
      "sfdescriptionc" : "<u><b>Context</b></u><br>You&#39;re using a third party solution to manage authentication in Sitecore via virtual user.<br><br>The solution to generate virtual users follows this kind of pattern, which is supported by Coveo for Sitecore<br> \n<pre class=\"ckeditor_codeblock\">\n// Create virtual user\nvar virtualUser = Sitecore.Security.Authentication.AuthenticationManager.BuildVirtualUser(&quot;ganesh.a.ramesh@accenture.com&quot;, true);\n \n// You can add roles to the Virtual user\nvirtualUser.Roles.Add(Sitecore.Security.Accounts.Role.FromName(&quot;extranet\\\\NURSE&quot;));\n \n// You can even work with the profile if you wish\nvirtualUser.Profile.SetCustomProperty(&quot;CustomProperty&quot;, &quot;12345&quot;);\nvirtualUser.Profile.Email = &quot;user@domain.com&quot;;\nvirtualUser.Profile.Name = &quot;My User&quot;;\n \n// Login the virtual user\nSitecore.Security.Authentication.AuthenticationManager.LoginVirtualUser(virtualUser);</pre>\n<br>Reference: <span style=\"font-size: 9.0pt;\"><a href=\"https://briancaos.wordpress.com/2015/11/13/sitecore-virtual-users-authenticate-users-from-external-systems/\" target=\"_blank\">https://briancaos.wordpress.com/2015/11/13/sitecore-virtual-users-authenticate-users-from-external-systems/</a></span><br><br>Also, your Sitecore has some restricted content that needs to be accessed only by certain users such as:<br> \n<ol><li><span style=\"font-size: 9.0pt;\">Extranet\\NURSE</span></li><li><span style=\"font-size: 9.0pt;\">Extranet\\MEDICAL_SPECIALIST</span></li><li><span style=\"font-size: 9.0pt;\">EXTRANET\\PHARMACIST</span></li><li><span style=\"font-size: 9.0pt;\">EXTRANET\\GENERAL_PRACTITIONER</span></li><li><span style=\"font-size: 9.0pt;\">Extranet\\Anonymous (By default, only in Login page)</span></li></ol>\n<u><b>Problem</b></u><br><br>When a visitor connects to the site, his virtual user gets one of the 5 profile attached to it. The problem is that those users only have access to the non-restricted content just as if they were extranet\\anonymous<br><br><br><br> ",
      "size" : 9203,
      "sfislatestversion" : "true",
      "sysdocumenttype" : "article",
      "sfcreateddate" : 1478895880000,
      "sfsourceid" : "5003200000ySUHyAAO",
      "clickableuri" : "https://na61.salesforce.com/kA13200000006rN",
      "syssource" : "Salesforce Public Items",
      "sfownerid" : "00560000003q7JgAAI",
      "orderingid" : 212384990660370898,
      "sfpublishstatus" : "Online",
      "syssize" : 9203,
      "sysdate" : 1511955956000,
      "sflanguage" : "en_US",
      "sysparents" : "<?xml version=\"1.0\" encoding=\"utf-16\"?><parents><parent name=\"Organization\" uri=\"https://na61.salesforce.com/home/home.jsp\" /><parent name=\"KB_Article__ka\" uri=\"http://www.salesforce.com/org:organization/articletype:KB_Article\" /><parent name=\"Managing permissions on third party authentication using virtual users in Coveo for Sitecore\" uri=\"https://na61.salesforce.com/kA13200000006rN\" /></parents>",
      "sfdcexpandedarticletype" : "All;All|Problem/Fix",
      "sfcurrencyisocode" : "CAD",
      "sfkbid" : "kA13200000006rNCAQ",
      "sfcausec" : "Unconfirmed",
      "sfdcexpandedproduct" : "All;All|Sitecore",
      "syssfcreateddate" : 1478895880000,
      "sflastmodifieddate" : 1478895911000,
      "sfisvisibleinpkb" : "true",
      "source" : "Salesforce Public Items",
      "sfarticletypec" : "How To",
      "sfisdeleted" : "false",
      "sfisvisibleincsp" : "true",
      "sfvalidationstatus" : "Reviewed",
      "sflastmodifiedbyname" : "Michael Carter",
      "collection" : "default",
      "sfdcproduct" : [ "Sitecore" ],
      "syssourcetype" : "Salesforce",
      "sfarticletype" : "KB_Article__kav",
      "indexeddate" : 1518187513000,
      "connectortype" : "Salesforce2",
      "filetype" : "SalesforceItem",
      "sfcreatedbyname" : "Frederic Cote",
      "sysclickableuri" : "https://na61.salesforce.com/kA13200000006rN",
      "sysfiletype" : "SalesforceItem",
      "language" : [ "English" ],
      "sffirstpublisheddate" : 1459958137000,
      "sfownername" : "Frederic Cote",
      "sitename" : "Community",
      "sysrowid" : 5492095,
      "uri" : "http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA13200000006rNCAQ/language:en_US",
      "syscollection" : "default"
    },
    "Title" : "Managing permissions on third party authentication using virtual users in Coveo for Sitecore",
    "Uri" : "http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA13200000006rNCAQ/language:en_US",
    "PrintableUri" : "http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA13200000006rNCAQ/language:en_US",
    "ClickUri" : "https://na61.salesforce.com/kA13200000006rN",
    "UniqueId" : "42.13819$http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA13200000006rNCAQ/language:en_US",
    "Excerpt" : "You're using a third party solution to manage authentication in Sitecore via virtual user. ... The solution to generate virtual users follows this kind of pattern, which is supported by Coveo for S...",
    "FirstSentences" : null
  }