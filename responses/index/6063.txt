{
    "title" : "Azure Web Application Firewall triggered rules block Coveo for Sitecore's communication on Content Delivery servers",
    "uri" : "http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA10d0000004MmvCAE/language:en_US",
    "printableUri" : "http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA10d0000004MmvCAE/language:en_US",
    "clickUri" : "https://na61.salesforce.com/kA10d0000004Mmv",
    "uniqueId" : "42.13819$http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA10d0000004MmvCAE/language:en_US",
    "excerpt" : "Queries do not seem to reach their endpoint and OWASP rules on Azure's Web Application Firewall (WAF) are being triggered. ... See this Microsoft article for more details. ... The reason why those ...",
    "firstSentences" : null,
    "summary" : null,
    "flags" : "HasHtmlVersion",
    "hasHtmlVersion" : true,
    "hasMobileHtmlVersion" : false,
    "score" : 1408,
    "percentScore" : 84.43408,
    "rankingInfo" : null,
    "rating" : 3.0,
    "isTopResult" : false,
    "isRecommendation" : false,
    "titleHighlights" : [ ],
    "firstSentencesHighlights" : [ ],
    "excerptHighlights" : [ ],
    "printableUriHighlights" : [ ],
    "summaryHighlights" : [ ],
    "parentResult" : null,
    "childResults" : [ ],
    "totalNumberOfChildResults" : 0,
    "raw" : {
      "systitle" : "Azure Web Application Firewall triggered rules block Coveo for Sitecore's communication on Content Delivery servers",
      "sysurihash" : "Lb0UbaðbZjYpjrAw",
      "urihash" : "Lb0UbaðbZjYpjrAw",
      "parents" : "<?xml version=\"1.0\" encoding=\"utf-16\"?><parents><parent name=\"Organization\" uri=\"https://na61.salesforce.com/home/home.jsp\" /><parent name=\"KB_Article__ka\" uri=\"http://www.salesforce.com/org:organization/articletype:KB_Article\" /><parent name=\"Azure Web Application Firewall triggered rules block Coveo for Sitecore's communication on Content Delivery servers\" uri=\"https://na61.salesforce.com/kA10d0000004Mmv\" /></parents>",
      "sfdcarticletype" : "Problem/Fix",
      "sfresolutionc" : "Disable the rules being triggered by the Web Application Firewall, as explained in <a href=\"https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-customize-waf-rules-portal\" target=\"_blank\">this Microsoft article</a>. Unfortunately, it is not possible at the moment (2017/12/07) to customize rules in Azure&#39;s WAF to exclude a specific endpoint.<br><br>When possible with a product update from Microsoft, the thing to do will be to exclude the <b>/coveo/rest</b> path from the triggered rules.",
      "sysuri" : "http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA10d0000004MmvCAE/language:en_US",
      "sysprintableuri" : "http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA10d0000004MmvCAE/language:en_US",
      "sflastpublisheddate" : 1513634192000,
      "systransactionid" : 161139,
      "sfurlname" : "2845",
      "sfsystemmodstamp" : 1517744065000,
      "sfisvisibleinapp" : "true",
      "sfcoveoversionc" : "Sitecore",
      "sysconcepts" : "OWASP rules ; coveo ; endpoint ; Microsoft ; WAF ; Firewall ; Azure ; query ; ModSecurity ; injection ; strict ruleset ; vanilla report ; POST body ; customize ; querystring ; Resolution",
      "sfkbversionnumber" : "1",
      "concepts" : "OWASP rules ; coveo ; endpoint ; Microsoft ; WAF ; Firewall ; Azure ; query ; ModSecurity ; injection ; strict ruleset ; vanilla report ; POST body ; customize ; querystring ; Resolution",
      "printableuri" : "http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA10d0000004MmvCAE/language:en_US",
      "documenttype" : "article",
      "sfkbarticlekavid" : "ka10d0000004Ta7AAE",
      "sysindexeddate" : 1518187597000,
      "sfknowledgearticleid" : "kA10d0000004MmvCAE",
      "sfcreatedbyid" : "00532000006JfuHAAS",
      "sfconnectorc" : "N/A",
      "permanentid" : "fc9bc834cab4f1ccc2a1a5924cef2b64e979e9bfd580dc62e82f4ba50c54",
      "syslanguage" : [ "English" ],
      "transactionid" : 161139,
      "sfisvisibleinprm" : "true",
      "title" : "Azure Web Application Firewall triggered rules block Coveo for Sitecore's communication on Content Delivery servers",
      "sfversionnumber" : 1,
      "sfarticlenumber" : "000002845",
      "date" : 1517744065000,
      "objecttype" : "KB Article",
      "allmetadatavalues" : "{\"kav_lastmodifiedby.attribute.type\": [\"User\"], \"coveo_short_id\": [\"kA10d0000004Mmv\"], \"sflastmodifiedbyname\": [\"Karel Mpungi\"], \"kav_coveo_version__c__html_stripped\": [\"Sitecore\"], \"fileextension\": [\"\"], \"sfdcexpandedproduct\": [\"All;All|Sitecore\"], \"kav_createdby.attribute.url\": [\"/services/data/v34.0/sobjects/User/00532000006JfuHAAS\"], \"sflanguage\": [\"en_US\"], \"kav_createdby.attribute.type\": [\"User\"], \"kav_createdby.id\": [\"00532000006JfuHAAS\"], \"kav_language\": [\"en_US\"], \"sfsitecoreversionc\": [\"N/A\"], \"sourcetype\": [\"Salesforce\"], \"title\": [\"Azure Web Application Firewall triggered rules block Coveo for Sitecore's communication on Content Delivery servers\"], \"source\": [\"Salesforce Public Items\"], \"kav_owner.attribute.url\": [\"/services/data/v34.0/sobjects/User/00532000006JfuHAAS\"], \"parents\": [\"<?xml version=\\\"1.0\\\" encoding=\\\"utf-16\\\"?><parents><parent name=\\\"Organization\\\" uri=\\\"https://na61.salesforce.com/home/home.jsp\\\" /><parent name=\\\"KB_Article__ka\\\" uri=\\\"http://www.salesforce.com/org:organization/articletype:KB_Article\\\" /><parent name=\\\"Azure Web Application Firewall triggered rules block Coveo for Sitecore's communication on Content Delivery servers\\\" uri=\\\"https://na61.salesforce.com/kA10d0000004Mmv\\\" /></parents>\"], \"sfisvisibleinprm\": [true], \"kav_title\": [\"Azure Web Application Firewall triggered rules block Coveo for Sitecore's communication on Content Delivery servers\"], \"kav_isvisibleincsp\": [true], \"hashtmlversion\": [true], \"kav_versionnumber\": [1], \"sfcreatedbyname\": [\"Gabriel Beaudoin\"], \"sflastpublisheddate\": [1513634192], \"objecttypelabel\": [\"KB Article\"], \"kav_cause__c__html_stripped\": [\"In  Prevention  mode, Azure's Web Application Firewall is blocking network calls that trigger OWASP rules. See  this Microsoft article  for more details. \\n \\n The reason why those rules are triggered is because OWASP rules are confusing the Coveo query syntax with SQL threats by misinterpreting the calls made to the Coveo REST endpoint as SQL injection. Some of the querystring arguments received by the REST endpoint might be used in a SQL query down the road. But Coveo for Sitecore does not call the database directly. It goes through the Sitecore API, so those are all false positives. \\n \\n In other words, we know that no one can perform SQL injection through the POST body because the payload is handled by Coveo and not an SQL database. \\n \\n As a side note, it is not uncommon for OWASP rules to generate lots of false positives in a vanilla report, as explained in  this Netnea article :\\n\\n ModSecurity \\u2013 or any WAF for that matter \\u2013 produces false positives. If it does not produce false positives, then it\\u2019s probably dead. A strict ruleset like the OWASP ModSecurity Core Rules 2.x brings a lot of false positives and it takes some tuning to get to a reasonable level of alerts.\"], \"originalhtmlcharset\": [1200], \"coveo_connector_hasbinarydata\": [false], \"kav_lastpublisheddate\": [1513634192], \"sfsystemmodstamp\": [1517744065], \"ka_attribute.type\": [\"KB_Article__ka\"], \"sfdcproduct\": [\"Sitecore\"], \"sfvendorversionc\": [\"Azure\"], \"kav_resolution__c__html_stripped\": [\"Disable the rules being triggered by the Web Application Firewall, as explained in  this Microsoft article . Unfortunately, it is not possible at the moment (2017/12/07) to customize rules in Azure's WAF to exclude a specific endpoint. \\n \\n When possible with a product update from Microsoft, the thing to do will be to exclude the  /coveo/rest  path from the triggered rules.\"], \"clickableuri\": [\"https://na61.salesforce.com/kA10d0000004Mmv\"], \"sftitle\": [\"Azure Web Application Firewall triggered rules block Coveo for Sitecore's communication on Content Delivery servers\"], \"kav_owner.id\": [\"00532000006JfuHAAS\"], \"sfisvisibleinapp\": [true], \"ka_attribute.url\": [\"/services/data/v34.0/sobjects/KB_Article__ka/kA10d0000004MmvCAE\"], \"sfdcarticletype\": [\"Problem/Fix\"], \"kav_cause__c\": [\"In <b>Prevention</b> mode, Azure&#39;s Web Application Firewall is blocking network calls that trigger OWASP rules. See <a href=\\\"https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-web-application-firewall-powershell\\\" target=\\\"_blank\\\">this Microsoft article</a> for more details.<br><br>The reason why those rules are triggered is because OWASP rules are confusing the Coveo query syntax with SQL threats by misinterpreting the calls made to the Coveo REST endpoint as SQL injection. Some of the querystring arguments received by the REST endpoint might be used in a SQL query down the road. But Coveo for Sitecore does not call the database directly. It goes through the Sitecore API, so those are all false positives.<br><br>In other words, we know that no one can perform SQL injection through the POST body because the payload is handled by Coveo and not an SQL database.<br><br>As a side note, it is not uncommon for OWASP rules to generate lots of false positives in a vanilla report, as explained in <a href=\\\"https://www.netnea.com/cms/2016/01/17/most-frequent-false-positives-triggered-by-owasp-modsecurity-core-rules-2-2-x/\\\" target=\\\"_blank\\\">this Netnea article</a>:\\n\\n<blockquote>ModSecurity \\u2013 or any WAF for that matter \\u2013 produces false positives. If it does not produce false positives, then it\\u2019s probably dead. A strict ruleset like the OWASP ModSecurity Core Rules 2.x brings a lot of false positives and it takes some tuning to get to a reasonable level of alerts.</blockquote>\"], \"sfislatestversion\": [true], \"sfcausec\": [\"In <b>Prevention</b> mode, Azure&#39;s Web Application Firewall is blocking network calls that trigger OWASP rules. See <a href=\\\"https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-web-application-firewall-powershell\\\" target=\\\"_blank\\\">this Microsoft article</a> for more details.<br><br>The reason why those rules are triggered is because OWASP rules are confusing the Coveo query syntax with SQL threats by misinterpreting the calls made to the Coveo REST endpoint as SQL injection. Some of the querystring arguments received by the REST endpoint might be used in a SQL query down the road. But Coveo for Sitecore does not call the database directly. It goes through the Sitecore API, so those are all false positives.<br><br>In other words, we know that no one can perform SQL injection through the POST body because the payload is handled by Coveo and not an SQL database.<br><br>As a side note, it is not uncommon for OWASP rules to generate lots of false positives in a vanilla report, as explained in <a href=\\\"https://www.netnea.com/cms/2016/01/17/most-frequent-false-positives-triggered-by-owasp-modsecurity-core-rules-2-2-x/\\\" target=\\\"_blank\\\">this Netnea article</a>:\\n\\n<blockquote>ModSecurity \\u2013 or any WAF for that matter \\u2013 produces false positives. If it does not produce false positives, then it\\u2019s probably dead. A strict ruleset like the OWASP ModSecurity Core Rules 2.x brings a lot of false positives and it takes some tuning to get to a reasonable level of alerts.</blockquote>\"], \"contenttype\": [\"binarydata\"], \"sfurlname\": [\"2845\"], \"ka_id\": [\"kA10d0000004MmvCAE\"], \"kav_datacategoryselections.datacategoryname\": [\"Sitecore;Configuration\"], \"coveo_url\": [\"https://na61.salesforce.com/kA10d0000004Mmv\"], \"kav_urlname\": [\"2845\"], \"kav_dc_expanded_product\": [\"All;All|Sitecore\"], \"foldingcollection\": [\"4bec5b95e82b191048540098c03146dc8c62a8207bf12c5196a950398c3e\"], \"body\": [\"<html>   <body>     <div style=\\\"background-color: #fff;border: 2px solid #BBC5CC;border-radius: 4px;float: left;font-family: lato;margin-left: 15px;margin-right: 15px;margin-bottom: 4%;padding: 10px;width: 60%;\\\">       <div style=\\\"font-size: 1.5em;font-weight: 600;Padding-top: 30px;border-bottom: 1px solid #BBC5CC;\\\">         <div style=\\\"border-left: 1px solid #BBC5CC;border-top: 1px solid #BBC5CC;color: #296896;padding: 10px;width: 15%;\\\">           Description         </div>       </div>       <div style=\\\"margin-left: 35px;margin-top: 10px;font-size: 1em;\\\"> On your Sitecore Content Delivery servers, you may have the following symptoms:\\n<ul><li>Queries do not seem to reach their endpoint and OWASP rules on Azure&#39;s Web Application Firewall (WAF) are being triggered.</li><li>403 unauthorized error message are received.</li></ul></div>       <div style=\\\"font-size: 1.5em;font-weight: 600;Padding-top: 30px;border-bottom: 1px solid #BBC5CC;\\\">         <div style=\\\"border-left: 1px solid #BBC5CC;border-top: 1px solid #BBC5CC;color: #296896;padding: 10px;width: 15%;\\\">           Environment         </div>       </div>       <br/>       <table>         <tr>           <td style=\\\"margin-left: 35px;margin-top: 10px;font-size: 1em;font-weight: 600;\\\">Product</td>           <td></td>           <td style=\\\"margin-left: 35px;margin-top: 10px;font-size: 1em;font-weight: 600;\\\">Sitecore Version</td>           <td>N/A</td>           <td style=\\\"margin-left: 35px;margin-top: 10px;font-size: 1em;font-weight: 600;\\\">Connector</td>           <td>N/A</td>         </tr>         <tr>           <td style=\\\"margin-left: 35px;margin-top: 10px;font-size: 1em;font-weight: 600;\\\">Published</td>           <td>1513634192</td>           <td style=\\\"margin-left: 35px;margin-top: 10px;font-size: 1em;font-weight: 600;\\\">Version</td>           <td></td>           <td style=\\\"margin-left: 35px;margin-top: 10px;font-size: 1em;font-weight: 600;\\\">Build</td>           <td></td>         </tr>       </table>       <br/>       <div style=\\\"font-size: 1.5em;font-weight: 600;Padding-top: 30px;border-bottom: 1px solid #BBC5CC;\\\">         <div style=\\\"border-left: 1px solid #BBC5CC;border-top: 1px solid #BBC5CC;color: #296896;padding: 10px;width: 15%;\\\">           Cause         </div>       </div>       <div style=\\\"margin-left: 35px;margin-top: 10px;font-size: 1em;\\\"> In <b>Prevention</b> mode, Azure&#39;s Web Application Firewall is blocking network calls that trigger OWASP rules. See <a href=\\\"https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-web-application-firewall-powershell\\\" target=\\\"_blank\\\">this Microsoft article</a> for more details.<br><br>The reason why those rules are triggered is because OWASP rules are confusing the Coveo query syntax with SQL threats by misinterpreting the calls made to the Coveo REST endpoint as SQL injection. Some of the querystring arguments received by the REST endpoint might be used in a SQL query down the road. But Coveo for Sitecore does not call the database directly. It goes through the Sitecore API, so those are all false positives.<br><br>In other words, we know that no one can perform SQL injection through the POST body because the payload is handled by Coveo and not an SQL database.<br><br>As a side note, it is not uncommon for OWASP rules to generate lots of false positives in a vanilla report, as explained in <a href=\\\"https://www.netnea.com/cms/2016/01/17/most-frequent-false-positives-triggered-by-owasp-modsecurity-core-rules-2-2-x/\\\" target=\\\"_blank\\\">this Netnea article</a>:\\n\\n<blockquote>ModSecurity \\u2013 or any WAF for that matter \\u2013 produces false positives. If it does not produce false positives, then it\\u2019s probably dead. A strict ruleset like the OWASP ModSecurity Core Rules 2.x brings a lot of false positives and it takes some tuning to get to a reasonable level of alerts.</blockquote></div>       <div style=\\\"font-size: 1.5em;font-weight: 600;Padding-top: 30px;border-bottom: 1px solid #BBC5CC;\\\">         <div style=\\\"border-left: 1px solid #BBC5CC;border-top: 1px solid #BBC5CC;color: #296896;padding: 10px;width: 15%;\\\">           Resolution         </div>       </div>       <div style=\\\"margin-left: 35px;margin-top: 10px;font-size: 1em;\\\"> Disable the rules being triggered by the Web Application Firewall, as explained in <a href=\\\"https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-customize-waf-rules-portal\\\" target=\\\"_blank\\\">this Microsoft article</a>. Unfortunately, it is not possible at the moment (2017/12/07) to customize rules in Azure&#39;s WAF to exclude a specific endpoint.<br><br>When possible with a product update from Microsoft, the thing to do will be to exclude the <b>/coveo/rest</b> path from the triggered rules.</div>     </div>   </body> </html>\"], \"sfpublishstatus\": [\"Online\"], \"sfcreatedbyid\": [\"00532000006JfuHAAS\"], \"kav_description__c__html_stripped\": [\"On your Sitecore Content Delivery servers, you may have the following symptoms:\\n Queries do not seem to reach their endpoint and OWASP rules on Azure's Web Application Firewall (WAF) are being triggered. 403 unauthorized error message are received.\"], \"kav_islatestversion\": [true], \"kav_knowledgearticleid\": [\"kA10d0000004MmvCAE\"], \"sfknowledgearticleid\": [\"kA10d0000004MmvCAE\"], \"sfownername\": [\"Gabriel Beaudoin\"], \"kav_datacategoryselections.attribute.type\": [\"KB_Article__DataCategorySelection;KB_Article__DataCategorySelection\"], \"detectedtitle\": [\"Description\"], \"kav_createddate\": [1512651761], \"language\": [\"English\"], \"coveo_foldingchild\": [\"4e64d6c46d2bb8a1c8a14c42540be5d5090c9c804fedaea91b34cb258997\"], \"sfownerid\": [\"00532000006JfuHAAS\"], \"kav_createdby.coveo_record_size\": [2], \"kav_vendor_version__c\": [\"Azure\"], \"kav_systemmodstamp\": [1517744065], \"objecttype\": [\"KB Article\"], \"connectortype\": [\"Salesforce2\"], \"kav_coveo_record_size\": [4], \"originaluri\": [\"http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA10d0000004MmvCAE/language:en_US\"], \"sfisvisibleincsp\": [true], \"convertertype\": [\"TYPE_HTML\"], \"filetype\": [\"SalesforceItem\"], \"kav_owner.name\": [\"Gabriel Beaudoin\"], \"sfcoveoversionc\": [\"Sitecore\"], \"sfdcexpandedarticletype\": [\"All;All|Problem/Fix\"], \"objecttypelabelplural\": [\"KB Articles\"], \"sfcurrencyisocode\": [\"CAD\"], \"sfisdeleted\": [false], \"extractedsize\": [3882], \"size\": [6514], \"kav_publishstatus\": [\"Online\"], \"kav_connector__c\": [\"N/A\"], \"generateexcerpt\": [true], \"sfdescriptionc\": [\"On your Sitecore Content Delivery servers, you may have the following symptoms:\\n<ul><li>Queries do not seem to reach their endpoint and OWASP rules on Azure&#39;s Web Application Firewall (WAF) are being triggered.</li><li>403 unauthorized error message are received.</li></ul>\"], \"sfarticletype\": [\"KB_Article__kav\"], \"kav_articletype\": [\"KB_Article__kav\"], \"kav_lastmodifieddate\": [1513634192], \"documenttype\": [\"article\"], \"sfkbarticlekavid\": [\"ka10d0000004Ta7AAE\"], \"kav_currencyisocode\": [\"CAD\"], \"foldingparent\": [\"4e64d6c46d2bb8a1c8a14c42540be5d5090c9c804fedaea91b34cb258997\"], \"mappingtype\": [\"KB_Article\"], \"kav_isvisibleinpkb\": [true], \"kav_sourceid\": [\"5000d00001GHuyOAAT\"], \"sfkbversionnumber\": [1], \"kav_isvisibleinapp\": [true], \"kav_resolution__c\": [\"Disable the rules being triggered by the Web Application Firewall, as explained in <a href=\\\"https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-customize-waf-rules-portal\\\" target=\\\"_blank\\\">this Microsoft article</a>. Unfortunately, it is not possible at the moment (2017/12/07) to customize rules in Azure&#39;s WAF to exclude a specific endpoint.<br><br>When possible with a product update from Microsoft, the thing to do will be to exclude the <b>/coveo/rest</b> path from the triggered rules.\"], \"coveo_objecttype\": [\"KB_Article\"], \"printableuri\": [\"http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA10d0000004MmvCAE/language:en_US\"], \"kav_datacategoryselections.attribute.url\": [\"/services/data/v34.0/sobjects/KB_Article__DataCategorySelection/02o0d000000m8FgAAI;/services/data/v34.0/sobjects/KB_Article__DataCategorySelection/02o0d000000m8FfAAI\"], \"kav_id\": [\"ka10d0000004Ta7AAE\"], \"sfresolutionc\": [\"Disable the rules being triggered by the Web Application Firewall, as explained in <a href=\\\"https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-customize-waf-rules-portal\\\" target=\\\"_blank\\\">this Microsoft article</a>. Unfortunately, it is not possible at the moment (2017/12/07) to customize rules in Azure&#39;s WAF to exclude a specific endpoint.<br><br>When possible with a product update from Microsoft, the thing to do will be to exclude the <b>/coveo/rest</b> path from the triggered rules.\"], \"foldingchild\": [\"4e64d6c46d2bb8a1c8a14c42540be5d5090c9c804fedaea91b34cb258997\"], \"sfcreateddate\": [1512651761], \"kav_sitecore_version__c\": [\"N/A\"], \"kav_owner.coveo_record_size\": [2], \"kav_coveo_effective_modstamp\": [1517744065], \"kav_summary__html_stripped\": [\"\"], \"kav_dc_article_type\": [\"Problem/Fix\"], \"sfconnectorc\": [\"N/A\"], \"kav_dc_product\": [\"Sitecore\"], \"ka_coveo_record_size\": [2], \"kav_dc_expanded_article_type\": [\"All;All|Problem/Fix\"], \"kav_datacategoryselections.coveo_record_size\": [\"2;2\"], \"concepts\": [\"OWASP rules ; coveo ; endpoint ; Microsoft ; WAF ; Firewall ; Azure ; query ; ModSecurity ; injection ; strict ruleset ; vanilla report ; POST body ; customize ; querystring ; Resolution\"], \"sfkbid\": [\"kA10d0000004MmvCAE\"], \"kav_firstpublisheddate\": [1513634192], \"coveo_organization_id\": [\"00D3000000007r2\"], \"coveo_foldingcollection\": [\"4bec5b95e82b191048540098c03146dc8c62a8207bf12c5196a950398c3e\"], \"sffirstpublisheddate\": [1513634192], \"sflastmodifieddate\": [1513634192], \"kav_coveo_version__c\": [\"Sitecore\"], \"kav_vendor_version__c__html_stripped\": [\"Azure\"], \"detectedlanguage\": [1], \"kav_isvisibleinprm\": [true], \"kav_owner.attribute.type\": [\"Name\"], \"kav_lastmodifiedby.attribute.url\": [\"/services/data/v34.0/sobjects/User/00560000002MKBSAA4\"], \"sitename\": [\"Community\"], \"kav_createdby.name\": [\"Gabriel Beaudoin\"], \"sfarticlenumber\": [\"000002845\"], \"kav_lastmodifiedby.coveo_record_size\": [2], \"sfisvisibleinpkb\": [true], \"kav_datacategoryselections.id\": [\"02o0d000000m8FgAAI;02o0d000000m8FfAAI\"], \"kav_description__c\": [\"On your Sitecore Content Delivery servers, you may have the following symptoms:\\n<ul><li>Queries do not seem to reach their endpoint and OWASP rules on Azure&#39;s Web Application Firewall (WAF) are being triggered.</li><li>403 unauthorized error message are received.</li></ul>\"], \"kav_attribute.url\": [\"/services/data/v34.0/sobjects/KB_Article__kav/ka10d0000004Ta7AAE\"], \"kav_articlenumber__stripped\": [\"2845\"], \"sfversionnumber\": [1], \"kav_attribute.type\": [\"KB_Article__kav\"], \"kav_validationstatus\": [\"Reviewed\"], \"coveo_foldingparent\": [\"4e64d6c46d2bb8a1c8a14c42540be5d5090c9c804fedaea91b34cb258997\"], \"collection\": [\"default\"], \"sfsourceid\": [\"5000d00001GHuyOAAT\"], \"date\": [1517744065], \"kav_lastmodifiedby.id\": [\"00560000002MKBSAA4\"], \"kav_datacategoryselections.datacategorygroupname\": [\"Product;Article_Type\"], \"conversionstate\": [0], \"sfvalidationstatus\": [\"Reviewed\"], \"kav_isdeleted\": [false], \"sflastmodifiedbyid\": [\"00560000002MKBSAA4\"], \"kav_lastmodifiedby.name\": [\"Karel Mpungi\"], \"kav_articlenumber\": [\"000002845\"], \"permanentid\": [\"fc9bc834cab4f1ccc2a1a5924cef2b64e979e9bfd580dc62e82f4ba50c54\"]}",
      "sflastmodifiedbyid" : "00560000002MKBSAA4",
      "syssfownerid" : "00532000006JfuHAAS",
      "sfsitecoreversionc" : "N/A",
      "sourcetype" : "Salesforce",
      "sysconnectortype" : "Salesforce2",
      "sftitle" : "Azure Web Application Firewall triggered rules block Coveo for Sitecore's communication on Content Delivery servers",
      "rowid" : 5493297,
      "syssfcreatedbyid" : "00532000006JfuHAAS",
      "sfdescriptionc" : "On your Sitecore Content Delivery servers, you may have the following symptoms:\n<ul><li>Queries do not seem to reach their endpoint and OWASP rules on Azure&#39;s Web Application Firewall (WAF) are being triggered.</li><li>403 unauthorized error message are received.</li></ul>",
      "size" : 6514,
      "sfislatestversion" : "true",
      "sysdocumenttype" : "article",
      "sfcreateddate" : 1512651761000,
      "sfsourceid" : "5000d00001GHuyOAAT",
      "clickableuri" : "https://na61.salesforce.com/kA10d0000004Mmv",
      "syssource" : "Salesforce Public Items",
      "sfownerid" : "00532000006JfuHAAS",
      "orderingid" : 212384990660372102,
      "sfpublishstatus" : "Online",
      "syssize" : 6514,
      "sysdate" : 1517744065000,
      "sflanguage" : "en_US",
      "sysparents" : "<?xml version=\"1.0\" encoding=\"utf-16\"?><parents><parent name=\"Organization\" uri=\"https://na61.salesforce.com/home/home.jsp\" /><parent name=\"KB_Article__ka\" uri=\"http://www.salesforce.com/org:organization/articletype:KB_Article\" /><parent name=\"Azure Web Application Firewall triggered rules block Coveo for Sitecore's communication on Content Delivery servers\" uri=\"https://na61.salesforce.com/kA10d0000004Mmv\" /></parents>",
      "sfdcexpandedarticletype" : "All;All|Problem/Fix",
      "sfcurrencyisocode" : "CAD",
      "sfkbid" : "kA10d0000004MmvCAE",
      "sfcausec" : "In <b>Prevention</b> mode, Azure&#39;s Web Application Firewall is blocking network calls that trigger OWASP rules. See <a href=\"https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-web-application-firewall-powershell\" target=\"_blank\">this Microsoft article</a> for more details.<br><br>The reason why those rules are triggered is because OWASP rules are confusing the Coveo query syntax with SQL threats by misinterpreting the calls made to the Coveo REST endpoint as SQL injection. Some of the querystring arguments received by the REST endpoint might be used in a SQL query down the road. But Coveo for Sitecore does not call the database directly. It goes through the Sitecore API, so those are all false positives.<br><br>In other words, we know that no one can perform SQL injection through the POST body because the payload is handled by Coveo and not an SQL database.<br><br>As a side note, it is not uncommon for OWASP rules to generate lots of false positives in a vanilla report, as explained in <a href=\"https://www.netnea.com/cms/2016/01/17/most-frequent-false-positives-triggered-by-owasp-modsecurity-core-rules-2-2-x/\" target=\"_blank\">this Netnea article</a>:\n\n<blockquote>ModSecurity – or any WAF for that matter – produces false positives. If it does not produce false positives, then it’s probably dead. A strict ruleset like the OWASP ModSecurity Core Rules 2.x brings a lot of false positives and it takes some tuning to get to a reasonable level of alerts.</blockquote>",
      "sfdcexpandedproduct" : "All;All|Sitecore",
      "syssfcreateddate" : 1512651761000,
      "sflastmodifieddate" : 1513634192000,
      "sfisvisibleinpkb" : "true",
      "source" : "Salesforce Public Items",
      "sfisdeleted" : "false",
      "sfisvisibleincsp" : "true",
      "sfvalidationstatus" : "Reviewed",
      "sflastmodifiedbyname" : "Karel Mpungi",
      "collection" : "default",
      "sfdcproduct" : [ "Sitecore" ],
      "syssourcetype" : "Salesforce",
      "sfarticletype" : "KB_Article__kav",
      "indexeddate" : 1518187597000,
      "connectortype" : "Salesforce2",
      "filetype" : "SalesforceItem",
      "sfcreatedbyname" : "Gabriel Beaudoin",
      "sysclickableuri" : "https://na61.salesforce.com/kA10d0000004Mmv",
      "sysfiletype" : "SalesforceItem",
      "sfvendorversionc" : "Azure",
      "language" : [ "English" ],
      "sffirstpublisheddate" : 1513634192000,
      "sfownername" : "Gabriel Beaudoin",
      "sitename" : "Community",
      "sysrowid" : 5493297,
      "uri" : "http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA10d0000004MmvCAE/language:en_US",
      "syscollection" : "default"
    },
    "Title" : "Azure Web Application Firewall triggered rules block Coveo for Sitecore's communication on Content Delivery servers",
    "Uri" : "http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA10d0000004MmvCAE/language:en_US",
    "PrintableUri" : "http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA10d0000004MmvCAE/language:en_US",
    "ClickUri" : "https://na61.salesforce.com/kA10d0000004Mmv",
    "UniqueId" : "42.13819$http://www.salesforce.com/org:organization/articletype:KB_Article/article:kA10d0000004MmvCAE/language:en_US",
    "Excerpt" : "Queries do not seem to reach their endpoint and OWASP rules on Azure's Web Application Firewall (WAF) are being triggered. ... See this Microsoft article for more details. ... The reason why those ...",
    "FirstSentences" : null
  }